{% extends 'base.html' %}
{% block title %}Dashboard - Service&nbsp;Desk{% endblock %}
{% block content %}

<!-- Counters for ticket statuses -->
<div style="display:flex;gap:16px;padding:16px;">
  <div class="card" style="flex:1;text-align:center;">
    <h3>Abertos</h3>
    <p style="font-size:24px;">{{ statuses['Aberto'] }}</p>
  </div>
  <div class="card" style="flex:1;text-align:center;">
    <h3>Aguardando</h3>
    <p style="font-size:24px;">{{ statuses['Aguardando'] }}</p>
  </div>
  <div class="card" style="flex:1;text-align:center;">
    <h3>Fechados</h3>
    <p style="font-size:24px;">{{ statuses['Fechado'] }}</p>
  </div>
</div>

<!-- Filter/search bar -->
<form class="filters" method="get" action="{{ url_for('dashboard') }}">
  <input type="text" name="q" placeholder="Buscar..." value="{{ query }}" />
  <select name="category">
    <option value="">Todas as categorias</option>
    {% for category in categories %}
    <option value="{{ category }}" {% if category == category_filter %}selected{% endif %}>{{ category }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="primary-btn">Filtrar</button>
  <a href="{{ url_for('export_csv') }}" class="primary-btn" style="background-color:#27ae60;">Exportar CSV</a>
  <a href="{{ url_for('export_markdown') }}" class="primary-btn" style="background-color:#e67e22;">Exportar MD</a>
</form>

<!-- List of tickets as cards -->
<div class="cards-container">
  {% if tickets %}
    {% set status_class_map = {'Aberto':'open','Aguardando':'waiting_customer','Fechado':'closed'} %}
    {% for ticket in tickets %}
    <div class="card">
      <h3>Ticket {{ ticket.id }}</h3>
      <span class="status-badge status-{{ status_class_map[ticket.status] }}">{{ ticket.status }}</span>
      <p><strong>Cliente:</strong> {{ ticket.client_name }}</p>
      <p>{{ ticket.description[:120] }}{% if ticket.description|length > 120 %}â€¦{% endif %}</p>
      <button class="open-btn" onclick="window.location.href='{{ url_for('ticket_detail', ticket_id=ticket.id) }}'">Detalhes</button>
    </div>
    {% endfor %}
  {% else %}
    <p style="padding:24px;">Nenhum ticket encontrado.</p>
  {% endif %}
</div>

{% endblock %}